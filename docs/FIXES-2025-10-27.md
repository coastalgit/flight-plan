# Flight Plan Fixes - October 27, 2025

## Issues Reported

After running `flight-plan init apply` on a new solution with 4 projects, multiple issues were observed:

1. **README files had no ref to "flight-plan status"** for next steps
2. **Inconsistent SpecKit prompting** - One project prompted, another didn't
3. **Absolute path errors** - One project referenced `c:\DEV\agora\.flight-plan\` instead of `c:\DEV\agora\TestAISolution\`
4. **Projects went straight to Phase 2 scaffolding** without proper Phase 1 guidance

---

## Root Causes Identified

### 1. **Outdated Command References**
Multiple templates still referenced old, non-existent commands:
- `flight-plan next` (renamed to `flight-plan status`)
- `flight-plan setup-speckit` (integrated into `flight-plan status`)
- `flight-plan enable-speckit` (never existed)
- `flight-plan phase [N]` (removed - phases transition conversationally)

### 2. **Missing Prerequisites Validation**
`flight-plan status` command had no explicit prerequisites check, which could lead to:
- Reading files from wrong directories
- Assuming parent directory structure
- Not validating current working directory

### 3. **Unclear Path Resolution**
Templates and documentation didn't explicitly state:
- All file reads should be relative to PROJECT directory, not parent
- SpecKit config is in `.flight-plan/config.json` in CURRENT directory
- Solution files are at `../flight-plan-solution/` from project directory

---

## Fixes Applied

### ‚úÖ 1. Updated GENERATOR.md

**README.md Template (Lines 460-474):**
```markdown
OLD:
- `flight-plan next` - Get guidance on what to do next
- `flight-plan setup-speckit` - Enable SpecKit integration (optional)

NEW:
1. Run `flight-plan status` for guidance on what to do next
2. AI will guide you through current phase objectives
3. Testing runs automatically during build phases
4. Optional: Enable SpecKit when prompted for feature-level development
```

**Impact:** New projects now have correct guidance in their README files.

---

### ‚úÖ 2. Updated templates/cursor-rule.mdc.template

**Flight Plan Commands Section (Lines 32-41):**
```markdown
OLD:
- `flight-plan next` - Get guidance (RECOMMENDED)
- `flight-plan setup-speckit` - Fetch & configure SpecKit
- `flight-plan phase [N]` - Move to phase N

NEW:
- `flight-plan status` - Get guidance, show current state, prompt SpecKit if needed (RECOMMENDED)
- `flight-plan prd refresh` - Update tracking from PRD edits
- `flight-plan note [text]` - Add activity note
```

**Natural Conversation Section (Lines 45-51):**
All references to `flight-plan next` changed to `flight-plan status`.

**SpecKit Integration Section (Lines 57-66):**
```markdown
OLD:
If not enabled: User can run `flight-plan setup-speckit` for guided setup

NEW:
Check `../../.flight-plan/config.json` for: "speckit_enabled": true/false
If not enabled: Run `flight-plan status` and AI will prompt for SpecKit setup
```

**Impact:** AI now knows to use correct commands and check config in proper location.

---

### ‚úÖ 3. Updated templates/project-rules.md.template

**SpecKit Integration Section (Lines 82-91):**
```markdown
OLD:
If No: Use `flight-plan enable-speckit` to set up Spec-Kit integration

NEW:
If No: Run `flight-plan status` and AI will prompt for SpecKit setup
```

**Flight Plan Commands Section (Lines 103-106):**
```markdown
OLD:
- `flight-plan enable-speckit` - Set up Spec-Kit (if desired)

NEW:
- `flight-plan status` - Get guidance on what to do next (shows testing, prompts SpecKit)
```

**Impact:** Project rules now guide AI to correct workflow.

---

### ‚úÖ 4. Updated FLIGHT-PLAN-COMMANDS.md

**Added Prerequisites Check to `flight-plan status` (Lines 323-343):**
```markdown
Prerequisites Check:
Before proceeding, verify:
1. ‚úÖ `project-prd.md` exists in current directory
2. ‚úÖ `.flight-plan/current.md` exists
3. ‚úÖ `.flight-plan/config.json` exists

If missing:
‚ùå Cannot show status: Missing project files

Expected files:
- project-prd.md (project requirements)
- .flight-plan/current.md (progress tracking)
- .flight-plan/config.json (project config)

Current directory: [show actual path]

If starting fresh, use "flight-plan init apply" from your solution directory first.
```

**Updated What It Does (Lines 345-351):**
```markdown
1. Reads `.flight-plan/current.md` from current directory
2. Reads `.flight-plan/config.json` from current directory
3. Shows current phase, activity, blockers
4. Shows PRD sync status
5. If build phase (5-6): Runs tests automatically
6. If SpecKit not prompted: Asks about SpecKit integration
```

**Fixed Example Reference (Line 667):**
Changed `"flight-plan test"` to `"flight-plan status"` (command doesn't exist).

**Updated SpecKit Integration Section (Lines 690-696):**
```markdown
For AI Implementers:
- Check `.flight-plan/config.json` in current directory (project root)
- Read `../flight-plan-solution/FLIGHT-PLAN-SPECKIT-SETUP.md` for setup instructions
- Only update `.flight-plan/config.json` in current directory to track status
- All file reads should be relative to project directory, not parent
```

**Impact:** AI now validates location before acting and reads files from correct paths.

---

### ‚úÖ 5. Updated README.md

**Added Directory Setup Guidance (Lines 173-179):**
```markdown
üìç Important: Directory Setup

You can open Cursor in either location:
- Option A: MyApp/flight-plan-solution/ (recommended for init)
- Option B: MyApp/ (lets you see all projects in explorer)

The system detects your location and adjusts paths automatically.
```

**Added Project Working Guidance (Lines 325-335):**
```markdown
üìç Tip: Open `MyApp/` in Cursor to see all projects in the explorer, then use terminal to navigate:
cd your-project/
"flight-plan status"

Or open the project directory directly:
Open MyApp/your-project/ in Cursor
"flight-plan status"
```

**Impact:** Users now understand they can open parent directory and system handles paths.

---

## Testing Recommendations

After these fixes, test the following scenarios:

### Scenario 1: Fresh Init
```bash
# In MyApp/flight-plan-solution/
flight-plan init apply

# Navigate to a project
cd ../project-a/
flight-plan status
```

**Expected:**
- ‚úÖ Shows current status (Phase 1)
- ‚úÖ Prompts for SpecKit integration
- ‚úÖ Guides user through Phase 1 objectives
- ‚úÖ No reference to non-existent commands

---

### Scenario 2: Parent Directory Opening
```bash
# Open MyApp/ in Cursor
# Terminal is at MyApp/

cd project-a/
flight-plan status
```

**Expected:**
- ‚úÖ Validates current directory has project files
- ‚úÖ Reads `.flight-plan/config.json` from current directory
- ‚úÖ Shows status correctly
- ‚úÖ No absolute path errors

---

### Scenario 3: README Guidance
```bash
# In any project
cat README.md
```

**Expected:**
- ‚úÖ No reference to `flight-plan next`
- ‚úÖ No reference to `flight-plan setup-speckit`
- ‚úÖ Clear guidance to run `flight-plan status`
- ‚úÖ Mention of automatic testing in build phases

---

### Scenario 4: Multiple Projects SpecKit Consistency
```bash
# Test 4 projects in sequence
cd project-a/
flight-plan status  # Should prompt for SpecKit

cd ../project-b/
flight-plan status  # Should prompt for SpecKit (independent config)
```

**Expected:**
- ‚úÖ Each project prompts independently (own config.json)
- ‚úÖ Consistent prompting behavior across all projects
- ‚úÖ No skipping directly to Phase 2 without Phase 1 guidance

---

## Summary

**Files Changed:**
1. `GENERATOR.md` - Updated README template generation
2. `templates/cursor-rule.mdc.template` - Updated command references
3. `templates/project-rules.md.template` - Updated command references
4. `FLIGHT-PLAN-COMMANDS.md` - Added prerequisites, updated SpecKit integration
5. `README.md` - Added directory setup guidance

**Commands Fixed:**
- ‚ùå `flight-plan next` ‚Üí ‚úÖ `flight-plan status`
- ‚ùå `flight-plan setup-speckit` ‚Üí ‚úÖ Integrated into `flight-plan status`
- ‚ùå `flight-plan enable-speckit` ‚Üí ‚úÖ Removed (never existed)
- ‚ùå `flight-plan phase [N]` ‚Üí ‚úÖ Removed (conversational now)
- ‚ùå `flight-plan test` ‚Üí ‚úÖ Integrated into `flight-plan status`

**Path Issues Fixed:**
- ‚úÖ Explicit validation of current directory
- ‚úÖ Clear guidance to read from project directory, not parent
- ‚úÖ Documentation of both directory opening options
- ‚úÖ System detects context and adjusts paths

**Result:** Flight Plan should now work consistently regardless of where Cursor is opened, with correct command references, proper SpecKit prompting, and no path confusion.

---

**Version:** Fixed in Flight Plan v1.0 (October 27, 2025)

