# SpecKit Three-File Architecture - 2025-10-28

**Date:** 2025-10-28  
**Issue:** User having to re-type PRD requirements into SpecKit  
**Solution:** Flight Plan generates three files from PRD, user points SpecKit at them

---

## The Problem

**User frustration:**
> "What!? We have specified EVERYTHING we need in PRD! Why would I do a specify.specify AGAIN!"

**Original (wrong) approach:**
1. User has detailed PRD with all requirements, tech stack, architecture
2. User enables SpecKit
3. Flight Plan generates `.specify/memory/constitution.md` with EVERYTHING (requirements + tech + principles)
4. User runs `/speckit.specify` ‚Üí Has to re-type requirements already in PRD!
5. User runs `/speckit.plan` ‚Üí Has to re-type tech stack already in PRD!

**Result:** Massive duplication, wasted effort, bad UX

---

## The User's Correct Insight

**User:** 
> "We should not be placing PRD type info in the constitution file - it is supposed to contain 'create your project's governing principles and development guidelines that will guide all subsequent development'"

> "We (flight-plan) should then build a 'spec' file for specify to interpret (by name - i.e. /specify.specify from docs/spec.md) and also the same for plan (/specify.plan from docs/plan.md)."

**This is exactly right!** Separation of concerns:
- **Constitution** = Principles & guidelines (HOW to work)
- **Spec** = Requirements & features (WHAT to build)
- **Plan** = Tech stack & architecture (HOW to build it)

---

## The Correct Architecture

### Three Files Generated from PRD

When user enables SpecKit, Flight Plan generates:

#### 1. `.specify/memory/constitution.md` (Principles ONLY)
```markdown
# [Project Name] Constitution

## Development Principles
- Follow Flight Plan phase standards
- Consult docs/project-prd.md for requirements
- Apply quality standards from PRD

## Quality Requirements
- Test coverage requirements
- Performance targets
- Security requirements
(References PRD, doesn't duplicate specifics)

## Workflow with Flight Plan
- Check current phase
- Reference project-spec.md for requirements
- Reference project-plan.md for tech approach
```

**Small, focused, principles-based**

---

#### 2. `docs/project-spec.md` (Requirements from PRD)
```markdown
# [Project Name] - Feature Specification

## Overview
[Extract from PRD Section 1]

## User Stories & Requirements
[Extract from PRD Section 3 - Functional Requirements]

## Success Criteria
[Extract from PRD]

## Constraints
[Extract from PRD]

## Open Questions
[Extract from PRD Section 8]
```

**This IS the spec - extracted from PRD, no duplication**

---

#### 3. `docs/project-plan.md` (Tech from PRD)
```markdown
# [Project Name] - Implementation Plan

## Technology Stack
Language: [from PRD]
Framework: [from PRD]
Database: [from PRD]

## Architecture
[Extract from PRD Section 4]

## Data Model
[Extract from PRD]

## API Design
[Extract from PRD]

## Quality Standards
[Extract from PRD]

## Dependencies
[Extract from PRD]
```

**This IS the plan - extracted from PRD, no duplication**

---

## How User Uses It

### User Flow (Correct):

```bash
# 1. Enable SpecKit
flight-plan status  # AI asks, user says "yes"

# 2. Install SpecKit
specify init . --ai cursor-agent --here

# 3. Flight Plan automatically generates:
#    ‚úì .specify/memory/constitution.md (principles)
#    ‚úì docs/project-spec.md (from PRD)
#    ‚úì docs/project-plan.md (from PRD)

# 4. Point SpecKit at Flight Plan files
/speckit.specify from docs/project-spec.md
/speckit.plan from docs/project-plan.md
/speckit.tasks
/speckit.implement
```

**No re-typing! No duplication! SpecKit reads from Flight Plan files!**

---

## What SpecKit Does

After reading `docs/project-spec.md` and `docs/project-plan.md`, SpecKit creates **its own internal structure**:

```
specs/
‚îî‚îÄ‚îÄ 001-feature-name/
    ‚îú‚îÄ‚îÄ spec.md          ‚Üê SpecKit's internal copy/refinement
    ‚îú‚îÄ‚îÄ plan.md          ‚Üê SpecKit's internal copy/refinement
    ‚îú‚îÄ‚îÄ tasks.md         ‚Üê Generated by /speckit.tasks
    ‚îú‚îÄ‚îÄ research.md      ‚Üê Optional
    ‚îî‚îÄ‚îÄ contracts/       ‚Üê API specs, etc.
```

**We don't touch SpecKit's internal files!** We just give it our files as input.

---

## File Ownership

| File | Owner | Purpose |
|------|-------|---------|
| `docs/project-prd.md` | Flight Plan | Single source of truth |
| `docs/project-spec.md` | Flight Plan | Generated from PRD for SpecKit |
| `docs/project-plan.md` | Flight Plan | Generated from PRD for SpecKit |
| `.specify/memory/constitution.md` | Flight Plan | Generated principles |
| `specs/[feature]/spec.md` | SpecKit | Internal copy/refinement |
| `specs/[feature]/plan.md` | SpecKit | Internal copy/refinement |
| `specs/[feature]/tasks.md` | SpecKit | Generated task breakdown |

**Clear separation: Flight Plan owns `docs/`, SpecKit owns `specs/`**

---

## Benefits

‚úÖ **No Duplication**
- PRD ‚Üí project-spec.md ‚Üí SpecKit reads it
- PRD ‚Üí project-plan.md ‚Üí SpecKit reads it
- User never re-types requirements

‚úÖ **Correct Separation**
- Constitution = principles (small, focused)
- Spec = requirements (from PRD)
- Plan = tech stack (from PRD)

‚úÖ **Single Source of Truth**
- PRD is the source
- Spec and plan are transformations
- SpecKit reads transformations
- No manual maintenance

‚úÖ **When PRD Changes**
```bash
flight-plan prd refresh apply
# Regenerates project-spec.md and project-plan.md

/speckit.specify from docs/project-spec.md  # Re-read updated spec
/speckit.plan from docs/project-plan.md     # Re-read updated plan
```

---

## Files Changed

### `framework/FLIGHT-PLAN-SPECKIT-SETUP.md`

**STEP 4 completely rewritten:**
- Now generates THREE files instead of one bloated constitution
- 4A: constitution.md (principles only, ~50 lines)
- 4B: project-spec.md (requirements from PRD)
- 4C: project-plan.md (tech from PRD)

**STEP 6 success message updated:**
```
Generated files from your PRD:
‚úì .specify/memory/constitution.md (principles & guidelines)
‚úì docs/project-spec.md (feature specifications from PRD)
‚úì docs/project-plan.md (implementation plan from PRD)

üöÄ NEXT STEPS:

Point SpecKit at your Flight Plan files:
  /speckit.specify from docs/project-spec.md
  /speckit.plan from docs/project-plan.md
  /speckit.tasks
  /speckit.implement
```

**"When PRD Changes" section updated:**
- Now regenerates all three files
- Instructions to re-point SpecKit at updated files

---

## User Journey Comparison

### Before (Wrong):
```
User: Has PRD with everything
‚Üì
Enables SpecKit
‚Üì
Gets constitution.md with tech stack
‚Üì
Runs /speckit.specify
SpecKit: "Describe the feature"
User: Types requirements AGAIN (from PRD) üò§
‚Üì
Runs /speckit.plan
SpecKit: "Describe tech stack"
User: Types tech stack AGAIN (from PRD) üò§
```

### After (Correct):
```
User: Has PRD with everything
‚Üì
Enables SpecKit
‚Üì
Gets:
  - constitution.md (principles)
  - project-spec.md (extracted from PRD)
  - project-plan.md (extracted from PRD)
‚Üì
Runs: /speckit.specify from docs/project-spec.md
SpecKit: Reads spec (done!) ‚úÖ
‚Üì
Runs: /speckit.plan from docs/project-plan.md
SpecKit: Reads plan (done!) ‚úÖ
‚Üì
Runs: /speckit.tasks
‚Üì
Runs: /speckit.implement
User: Building! üöÄ
```

---

## Key Insight

**SpecKit commands accept file references!**

You can tell them: `/speckit.specify from docs/project-spec.md`

This means Flight Plan's job is to:
1. Transform PRD into SpecKit-compatible format
2. Put it in files SpecKit can read
3. Tell user how to point SpecKit at those files

**We're not creating SpecKit's internal structure - we're feeding it OUR files!**

---

**Change Date:** 2025-10-28  
**Severity:** CRITICAL - Fixes fundamental UX issue  
**Impact:** Users no longer duplicate PRD content  
**Breaking:** YES - existing constitution.md files are wrong structure  
**Migration:** Delete old constitution.md, re-enable SpecKit to get new three-file structure

